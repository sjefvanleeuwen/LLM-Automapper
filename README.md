# LLM RAG C# Automapper Data Mapper

A powerful data mapping tool that uses Large Language Models (LLM) with Retrieval Augmented Generation (RAG) to intelligently generate C# AutoMapper code for transforming data between different structures.

## What is AutoMapper?

AutoMapper is a popular object-to-object mapping library for .NET that simplifies the code needed to transform data from one type to another. Rather than writing tedious mapping code by hand:

```csharp
targetObject.Property1 = sourceObject.Property1;
targetObject.Property2 = sourceObject.Property2;
// ... many more mappings
```

AutoMapper lets you define mapping configurations once and then transform objects with a single line of code:

```csharp
var result = mapper.Map<TargetType>(sourceObject);
```

## How This Tool Uses LLM AI

This tool combines the power of AutoMapper with artificial intelligence to:

1. **Understand Data Structures**: The LLM (Llama3) analyzes your data structures, whether they're in JSON, CSV, plain text descriptions, or other formats
2. **Semantic Field Matching**: Instead of rigid string matching, the AI understands the meaning of fields and matches them based on semantic similarity
3. **Code Generation**: Automatically generates complete, compilable C# code with the appropriate AutoMapper configurations
4. **Knowledge Enhancement**: Uses a vector database with RAG (Retrieval Augmented Generation) to enrich mappings with knowledge from similar structures
5. **Smart Transformations**: Handles nested objects, arrays, and type conversions intelligently

## Prerequisites

- Node.js (v14.0.0 or higher)
- [Ollama](https://ollama.ai/) installed and running locally
- Llama3 model pulled in Ollama (`ollama pull llama3`)
- An embedding model in Ollama (`ollama pull nomic-embed-text:latest`)

## Installation

1. Clone the repository:
   ```
   git clone https://github.com/yourusername/rag3-data-mapper.git
   cd rag3-data-mapper
   ```

2. Install dependencies:
   ```
   npm install
   ```

3. Ensure Ollama is running with the required models:
   ```
   ollama serve
   ollama pull llama3
   ollama pull nomic-embed-text:latest
   ```

## Usage

### Loading Data Files

Load and embed data structure files from a directory:

```
npm run load -- ./data
```

This command:
- Scans the specified directory for data structure files
- Extracts structure information from each file
- Creates vector embeddings for semantic search
- Saves the processed structures to `embedded-structures.json`

### Mapping Between Data Structures

Map fields between source and target data structures:

```
npm run map -- ./data/example-source.json ./data/example-target.json
```

This command:
- Generates semantic mappings between fields using AI understanding
- Uses any previously embedded structures to enhance mapping accuracy
- Outputs field-to-field mappings with confidence scores
- Generates C# code with AutoMapper for performing the data transformation
- Saves the mapping code to a .cs file

### Analyzing a Data Description

Analyze a plain text description of a data structure:

```
npm run analyze -- ./data/example-description.txt
```

This command:
- Extracts structured information from a textual description
- Identifies fields, types, and relationships
- Provides an analysis of the implied data structure
- Saves the extracted structure to a .json file

### Querying the Vector Database

Search for information in the vector database:

```
npm run query -- "customer address fields"
```

This command:
- Searches the vector database for relevant documents and fields
- Provides analysis of how the query relates to existing data structures
- Shows which fields and structures are most relevant to the query
- Generates a markdown report with the search results

## AI-Generated AutoMapper Code

The C# code generated by this tool includes:

1. **Complete Class Definitions**: C# classes for both source and target data structures
2. **AutoMapper Profile**: A configuration class that defines all mappings
3. **Complex Mappings**: Handles nested properties, collections, and flattening/unflattening
4. **Type Conversions**: Intelligently handles type differences between source and target
5. **Usage Example**: Demonstrates how to use the mappings in a real application

For example, when mapping customer data between systems, the LLM AI might generate code like:

```csharp
CreateMap<SourceCustomer, TargetClient>()
    .ForMember(dest => dest.ClientId, opt => opt.MapFrom(src => src.CustomerId))
    .ForMember(dest => dest.Name, opt => opt.MapFrom(src => new TargetName {
        First = src.FirstName,
        Last = src.LastName
    }))
    .ForMember(dest => dest.ContactInfo, opt => opt.MapFrom(src => new ContactInfo {
        EmailAddress = src.Email,
        Phone = src.PhoneNumber
    }));
```

## How It Works

1. **Parsing**: Files are parsed using a combination of direct parsing and LLM assistance
2. **Embedding**: Field names and descriptions are embedded using vector representations
3. **Semantic Matching**: The system uses semantic similarity to match corresponding fields
4. **RAG Enhancement**: Knowledge from the vector database enriches the mapping process
5. **AI Code Generation**: The LLM generates complete, customized AutoMapper code
6. **Field Confidence**: Each mapping includes a confidence score to identify uncertain matches

## License

MIT
